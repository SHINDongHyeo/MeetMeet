<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="description" content="" />
<meta name="author" content="" />
<title>밋밋</title>
<!-- Favicon-->
<link rel="icon" type="image/x-icon" href="assets/handshaking.png" />
<!-- Bootstrap icons-->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"
	rel="stylesheet" />
<!-- Core theme CSS (includes Bootstrap)-->
<link href="css/styles_dh.css" rel="stylesheet" />
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<style>
#slider-wrap {
	box-sizing: content-box;
	width: 1202px;
	height: 267px;
	position: relative;
	overflow: hidden;
	margin: auto;
}

#slider-wrap ul#slider {
	border: 1px solid pink;
	margin: auto;
	box-sizing: content-box;
	height: 100%;
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	list-style: none;
	padding: 0;
}

#slider-wrap ul#slider li {
	float: left;
	position: relative;
	width: 100%;
	height: 100%;
}

#slider-wrap ul#slider li img {
	display: block;
	width: 100%;
	height: 100%;
}

/* btns */
.slider-btns {
	position: absolute;
	width: 50px;
	height: 60px;
	top: 50%;
	margin-top: -25px;
	line-height: 57px;
	text-align: center;
	cursor: pointer;
	background: rgba(0, 0, 0, 0.1);
	z-index: 100;
	-webkit-user-select: none;
	-moz-user-select: none;
	-khtml-user-select: none;
	-ms-user-select: none;
	-webkit-transition: all 0.1s ease;
	-o-transition: all 0.1s ease;
	transition: all 0.1s ease;
}

.slider-btns:hover {
	background: rgba(0, 0, 0, 0.3);
}

#next {
	right: -50px;
	border-radius: 7px 0px 0px 7px;
	color: #eee;
}

#previous {
	left: -50px;
	border-radius: 0px 7px 7px 7px;
	color: #eee;
}

#slider-wrap.active #next {
	right: 0px;
}

#slider-wrap.active #previous {
	left: 0px;
}

/*bar*/
#slider-pagination-wrap {
	min-width: 20px;
	margin-top: 230px;
	margin-left: auto;
	margin-right: auto;
	height: 15px;
	position: relative;
	text-align: center;
}

#slider-pagination-wrap ul {
	width: 100%;
}

#slider-pagination-wrap ul li {
	margin: 0 4px;
	display: inline-block;
	width: 5px;
	height: 5px;
	border-radius: 50%;
	background: #fff;
	opacity: 0.5;
	position: relative;
	top: 0;
}

#slider-pagination-wrap ul li.active {
	width: 12px;
	height: 12px;
	top: 3px;
	opacity: 1;
	-webkit-box-shadow: rgba(0, 0, 0, 0.1) 1px 1px 0px;
	box-shadow: rgba(0, 0, 0, 0.1) 1px 1px 0px;
}

/*ANIMATION*/
#slider-wrap ul, #slider-pagination-wrap ul li {
	-webkit-transition: all 0.3s cubic-bezier(1, .01, .32, 1);
	-o-transition: all 0.3s cubic-bezier(1, .01, .32, 1);
	transition: all 0.3s cubic-bezier(1, .01, .32, 1);
}
</style>








<body>
	<!-- Navigation-->
	<div w3-include-html="nav.html"></div>
	<!-- Header-->
	<header class="bg-dark py-5">
		<div style="border: 1px solid red;">
			<div id="slider-wrap" style="border: 1px solid blue;">

				<ul id="slider">
					<li><img alt="사진못찾음" src="images/(13).png"
						style="max-width: 1200px; max-height: 265px;"></li>

					<li><img alt="사진못찾음" src="images/(14).png"
						style="max-width: 1200px; max-height: 265px;"></li>
					<li><img alt="사진못찾음" src="images/(15).png"
						style="max-width: 1200px; max-height: 265px;"></li>
				</ul>
				<div class="slider-btns" id="next">
					<span>▶</span>
				</div>
				<div class="slider-btns" id="previous">
					<span>◀</span>
				</div>

				<div id="slider-pagination-wrap">
					<ul>
					</ul>
				</div>
			</div>
		</div>
	</header>



	<div class="container px-4 px-lg-5 my-5">
		<button id="get_moem_btn" onclick="get_moem()">모임 더보기</button>
		<div>
			<h5 id="remained_moem">참가 중인 모임</h5>
			<div id="moem_list" class="text-center text-white" style="background-color: rgb(244 98 58 / 70%); border-radius: 5%;"></div>
		</div>
		<div id="item_list" class="text-center text-white"></div>
	</div>

	<!-- 모달 부분 -->
	<div id="modal" class="modal-overlay">
		<div class="modal-window">
			<div class="title">
				<h2>모달</h2>
			</div>
			<div class="close-area">X</div>
			<div class="content">
				<div class="card-body p-4">
					<div class="text-center">
						<img class="card-img-top" src="" alt="..." />
					</div>
				</div>
				<div class="card-body p-4">
					<div class="text-center">
						<h5 class="fw-bolder"></h5>
						<h8 class="fw-bolder2"></h8>
					</div>
				</div>
			</div>
			<form id="detailform" action="" method="get">
				<input class="form-control" id="meetingId" type="hidden"
								name="meetingId" />
				<button class="btn btn-primary btn-xl" id="detailButton"
									type="submit">자세히보기</button>
			</form>
		</div>
	</div>
	<!-- Section-->
	<section class="py-5">
		<div class="container px-4 px-lg-5 mt-5">
			<div
				class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">

			</div>
		</div>
		<!-- Footer-->
		<footer class="py-5 bg-dark">
			<div class="container">
				<p class="m-0 text-center text-white">Copyright &copy; Your
					Website 2022</p>
			</div>
		</footer>
		<!-- Bootstrap core JS-->
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
		<!-- Core theme JS-->
		<script src="js/scripts.js"></script>
		<script>
            var slideWrapper = document.getElementById('slider-wrap');
            //current slideIndexition
            var slideIndex = 0;
            //items
            var slides = document.querySelectorAll('#slider-wrap ul li');
            //number of slides
            var totalSlides = slides.length;
            //get the slide width
            var sliderWidth = slideWrapper.clientWidth;
            //set width of items
            slides.forEach(function (element) {
                element.style.width = sliderWidth + 'px';
            })
            //set width to be 'x' times the number of slides
            var slider = document.querySelector('#slider-wrap ul#slider');
            slider.style.width = sliderWidth * totalSlides + 'px';

            // next, prev
            var nextBtn = document.getElementById('next');
            var prevBtn = document.getElementById('previous');

            nextBtn.addEventListener('click', function () {
                plusSlides(1);
            });
            prevBtn.addEventListener('click', function () {
                plusSlides(-1);
            });

            // hover
            slideWrapper.addEventListener('mouseover', function () {
                this.classList.add('active');
                clearInterval(autoSlider);
            });
            slideWrapper.addEventListener('mouseleave', function () {
                this.classList.remove('active');
                autoSlider = setInterval(function () {
                    plusSlides(1);
                }, 3000);
            });


            function plusSlides(n) {
            	console.log("plusslide");
                showSlides(slideIndex += n);
            }

            function currentSlides(n) {
                showSlides(slideIndex = n);
            }

            function showSlides(n) {
                slideIndex = n;
                if (slideIndex == -1) {
                    slideIndex = totalSlides - 1;
                } else if (slideIndex === totalSlides) {
                    slideIndex = 0;
                }

                slider.style.left = -(sliderWidth * slideIndex) + 'px';
                pagination();
            }

            //pagination
            slides.forEach(function () {
            	console.log("slide.foreach");
                var li = document.createElement('li');
                document.querySelector('#slider-pagination-wrap ul').appendChild(li);
            })

            function pagination() {
            	console.log("pagination");
                var dots = document.querySelectorAll('#slider-pagination-wrap ul li');
                dots.forEach(function (element) {
                    element.classList.remove('active');
                });
                dots[slideIndex].classList.add('active');
            }

            pagination();
            var autoSlider = setInterval(function () {
            	console.log("autoslider");
                plusSlides(1);
            }, 3000);
        </script>
		<script>
			
			var item_list = [];
			var my_item_list = [];
	        var count = 12;
	        
			loadItem();
 			function loadItem(){
				axios({
					method: 'get',
					url: '/getall'
				}).then(function (res){
					to_item_list(res.data);
				}).catch(function (err){
					console.log(err);
				});
			}
 			
 			/* function get_my_item(){
				axios({
					method: 'get',
					url: '/getall'
				}).then(function (res){
					to_item_list(res.data);
				}).catch(function (err){
					console.log(err);
				});
			} */
 			
 			function to_item_list(lists){
 				for(let i = 0; i < lists.length; i ++){
 					item_list.push(
 							{	"meetingId" : lists[i].meetingId,
 								"name": lists[i].meetingName,
			        			"img": lists[i].filepath,
			        			"content": lists[i].meetingDetail}
 							)
 				}
 				/* 무한스크롤 함수 */
 		        get_new_item(0, 12);
 				console.log(item_list);
 			}
 			     	   
	        function get_new_item(start, end){
		       for(start; start < end; start ++){
		    	   var new_id = item_list[start].meetingId	/* "btn-modal" +   */
		    	   document.getElementById("item_list").innerHTML += 
		    		   '<div id="' + new_id + '"class="cards"><div class="card h-100"><img class="card-img-top" src=' +
		    		   				item_list[start].img +
			                ' alt="..." /><div class="card-body p-4"><div class="text-center"><h5 class="fw-bolder">' +
			                		item_list[start].name +
			                        '</h5><h8 class="fw-bolder2">' +
			                        item_list[start].content +
			                    '</h8></div></div><div class="card-footer p-4 pt-0 border-top-0 bg-transparent"><div class="text-center"><button class="btn btn-outline-dark mt-auto" onclick="modalOn1(event)">View options</button></div></div></div></div>';
                    
                   /*  document.getElementById("btn-modal" + start).addEventListener("click", e => {
                        modalOn();
                    }); */
		       }
	        }
	        
		      //스크롤 바닥 감지
		      window.onscroll = function(e) {
		          //추가되는 임시 콘텐츠
		          //window height + window scrollY 값이 document height보다 클 경우,
		          if((window.innerHeight + window.scrollY) >= document.body.offsetHeight) {
		          	//실행할 로직 (콘텐츠 추가)
		              count += 8;
			          get_new_item(count - 8, count);
		          }
		      };
	        
		      
	      /*참석중인 모임 리스팅 함수 */
	      
	      let next_page_moem = 0;
	      get_moem();
	      
	       function get_moem(){
	    	   if(next_page_moem > item_list.length){
	    		   return;
	    	   }
	    	   for(i in item_list){
	    		   if(i > 9){
	    			   next_page_moem += Number(i);
	    			   break;
	    		   }
	    		   try{
		    		   i = Number(i) + next_page_moem;
		    		   var new_id = item_list[i].meetingId;
			    	   document.getElementById("moem_list").innerHTML += 
			    		   '<div id="' + new_id + '" class="moem_list_wrap"><div class="cards_image" ><img class="card_image_image" src=' +
			    		   				item_list[i].img +
				                ' alt="..." onclick="modalOn2(event)" /></div><div class="moem_list_wrap_text"><h5 class="fw-bolder3">' +
		                		item_list[i].name +
		                        '</h5></div></div>'
	    		   }catch(error){
	    			   next_page_moem = item_list.length;
	    			   break;
	    		   }
		       }
	    	   document.getElementById("remained_moem").innerText = "남은 모임 : " + (item_list.length - next_page_moem);
	       }
	       
	       
	       /* 모달 함수들  */
	       
	       const modal = document.getElementById("modal");
	       
	       function modalOn1(e) {
    		   console.log(e.target.parentElement.parentElement.parentElement.parentElement);
	           modal.style.display = "flex";
	           modal_content(e.target.parentElement.parentElement.parentElement.parentElement.id);
	       };
	       
	       function modalOn2(e) {
	    	   console.log(e.target.parentElement.parentElement.id);
	           modal.style.display = "flex";
	           modal_content(e.target.parentElement.parentElement.id);
	       };
	       
	       function isModalOn() {
	           return modal.style.display === "flex";
	       };
	       
	       function modalOff() {
	           modal.style.display = "none";
	       };
	       
	            
	       const closeBtn = modal.querySelector(".close-area");
	       
	       closeBtn.addEventListener("click", e => {
	           modalOff();
	       });
	       
	       modal.addEventListener("click", e => {
	           const evTarget = e.target
	           if(evTarget.classList.contains("modal-overlay")) {
	               modalOff();
	           }
	       });
	       
	       window.addEventListener("keyup", e => {
	           if(isModalOn() && e.key === "Escape") {
	               modalOff();
	           }
	       });
	       
	       function modal_content(parent_id){
	    	   var parent_tag = document.getElementById(parent_id);
	    	   console.log(item_list[parent_id]);
	    	   var modal_tag = document.getElementById("modal");
	    	   document.getElementById("detailform").action = "/meetmeet/detail?meetingId=" + parent_id;
	    	   document.getElementById("meetingId").value = parent_id;
	    	   for(let i = 0; i < item_list.length; i ++){
	    		   if(item_list[i].meetingId == parent_id){
			    	   modal_tag.getElementsByClassName("card-img-top")[0].src = item_list[i].img;
			    	   modal_tag.getElementsByClassName("fw-bolder")[0].innerText = item_list[i].name;
			    	   modal_tag.getElementsByClassName("fw-bolder2")[0].innerText = item_list[i].content;
	    		   }
	    	   }
/* 	    	   modal_tag.getElementsByClassName("card-img-top")[0].src = parent_tag.getElementsByClassName("card-img-top")[0].src;
	    	   modal_tag.getElementsByClassName("fw-bolder")[0].innerText = parent_tag.getElementsByClassName("fw-bolder")[0].innerText;
	    	   modal_tag.getElementsByClassName("fw-bolder2")[0].innerText = parent_tag.getElementsByClassName("fw-bolder2")[0].innerText; */
	       }
	       
	       includeHTML();
	       function includeHTML() {
	    	   var z, i, elmnt, file, xhttp;
	    	   /* Loop through a collection of all HTML elements: */
	    	   z = document.getElementsByTagName("*");
	    	   for (i = 0; i < z.length; i++) {
	    	     elmnt = z[i];
	    	     /*search for elements with a certain atrribute:*/
	    	     file = elmnt.getAttribute("w3-include-html");
	    	     if (file) {
	    	       /* Make an HTTP request using the attribute value as the file name: */
	    	       xhttp = new XMLHttpRequest();
	    	       xhttp.onreadystatechange = function() {
	    	         if (this.readyState == 4) {
	    	           if (this.status == 200) {elmnt.innerHTML = this.responseText;}
	    	           if (this.status == 404) {elmnt.innerHTML = "Page not found.";}
	    	           /* Remove the attribute, and call this function once more: */
	    	           elmnt.removeAttribute("w3-include-html");
	    	           includeHTML();
	    	         }
	    	       }
	    	       xhttp.open("GET", file, true);
	    	       xhttp.send();
	    	       /* Exit the function: */
	    	       return;
	    	     }
	    	   }
	    	 }
	      	
        </script>
</body>
</html>
